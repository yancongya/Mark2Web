# 下拉列表功能测试指南

## 测试前准备

1. 生成至少2个版本的网页输出
2. 上传至少2个源文件（可选）

---

## 测试用例

### 测试1：顶栏输出标签小箭头（Code Tab）

**步骤**：
1. 切换到 Code Tab
2. 确保有多个版本（HTML/React/Vue）
3. 点击输出标签（如 HTML）右侧的小箭头 ▼

**预期结果**：
- ✅ 下拉列表展开，显示所有版本
- ✅ 可以选择其他版本
- ✅ 可以删除版本（如果 > 1 个）
- ✅ 点击外部关闭

**验证独立性**：
- 点击小箭头打开下拉
- 确认独立版本选择器按钮仍然可见但未激活
- 点击独立按钮，应该关闭小箭头下拉，打开独立下拉

---

### 测试2：顶栏独立版本选择器（Code Tab）

**步骤**：
1. 切换到 Code Tab
2. 点击右侧的版本选择器按钮（显示如 "v2"）

**预期结果**：
- ✅ 下拉列表展开
- ✅ 显示所有格式和版本
- ✅ 可以选择/删除版本
- ✅ 点击外部关闭

**验证独立性**：
- 打开独立下拉
- 确认输出标签小箭头下拉未打开
- 点击小箭头，应该关闭独立下拉，打开小箭头下拉

---

### 测试3：Source Tab

**步骤**：
1. 切换到 Source Tab
2. 如果有多个源文件，点击文件名
3. 如果有输出，点击右侧版本选择器

**预期结果**：
- ✅ 文件名下拉正常工作（源文件版本）
- ✅ 版本选择器正常工作（输出版本）
- ✅ 两者互不干扰

---

### 测试4：Preview Tab

**步骤**：
1. 切换到 Preview Tab
2. 点击右上角的版本选择器

**预期结果**：
- ✅ 下拉列表展开
- ✅ 可以选择/删除版本
- ✅ 顶栏的两个下拉按钮不显示

---

### 测试5：骨架动画

**步骤**：
1. 点击生成按钮
2. 在生成过程中观察骨架动画
3. 生成完成后，立即切换到其他版本

**预期结果**：
- ✅ 生成过程中显示骨架动画
- ✅ 生成完成后骨架动画自动消失
- ✅ 可以正常切换查看其他版本
- ✅ 不会卡在骨架状态

---

### 测试6：删除功能

**步骤**：
1. 在任意下拉列表中点击删除按钮（垃圾桶图标）
2. 确认删除对话框
3. 检查删除结果

**预期结果**：
- ✅ 显示确认对话框
- ✅ 删除后自动选择其他版本
- ✅ 如果删除的是最后一个版本，不显示删除按钮
- ✅ 所有下拉列表同步更新

---

### 测试7：点击外部关闭

**步骤**：
1. 打开任意下拉列表
2. 点击页面其他位置

**预期结果**：
- ✅ 下拉列表关闭
- ✅ 所有4个下拉列表都能通过点击外部关闭

---

## 常见问题排查

### 问题：点击按钮无反应

**可能原因**：
- 没有输出版本
- 当前tab不满足显示条件

**检查**：
- 确认有 `activeOutputId`
- 确认 `outputs.length > 0`
- 检查 `activeTab` 是否正确

### 问题：两个下拉同时打开

**可能原因**：
- 状态变量未正确隔离

**检查**：
- 确认使用了不同的状态变量
- 确认互相关闭逻辑已添加

### 问题：删除按钮不显示

**可能原因**：
- 只有1个版本
- `onDeleteOutput` 未传递

**检查**：
- 确认版本数 > 1
- 确认 App.tsx 传递了 `onDeleteOutput` prop

---

## 代码位置参考

- **状态定义**：ResultViewer.tsx:484-491
- **点击外部关闭**：ResultViewer.tsx:545-567
- **输出标签小箭头**：ResultViewer.tsx:1060-1130
- **独立版本选择器**：ResultViewer.tsx:1149-1232
- **预览tab选择器**：ResultViewer.tsx:1343-1397
- **源文件下拉**：ResultViewer.tsx:964-1009
- **App删除处理**：App.tsx:323-385
